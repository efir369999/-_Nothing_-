# ACP — Presence-Based Consensus

**Implementation:** `montana/src/consensus.rs`
**Version:** 1.0

---

## Core

```rust
// consensus.rs:7-14
// Bitcoin asks: "How much work did you do?" (PoW)
// Ethereum asks: "How much did you stake?" (PoS)
// Montana asks: "ARE YOU HERE?"
//
// 80% — servers (Full Node) — infrastructure
// 20% — people (Verified User) — decentralization
//
// lim(evidence → ∞) 1 Ɉ → 1 second
```

---

## Architecture (80/20)

| Node Type | Share | Interval | Requirements |
|-----------|-------|----------|--------------|
| Full Node | 80% | τ₁ (1 min) | Automatic signature |
| Verified User | 20% | 10-40 min | Biometrics + FIDO2 |

**From code:**
```rust
pub const FULL_NODE_CAP_PERCENT: u64 = 80;
pub const VERIFIED_USER_CAP_PERCENT: u64 = 20;
```

---

## Presence Proof

Full Node signs every τ₁:
```rust
// consensus.rs:177-190
msg.extend_from_slice(b"MONTANA_PRESENCE_V1:");
msg.extend_from_slice(&timestamp.to_le_bytes());
msg.extend_from_slice(prev_slice_hash);
msg.extend_from_slice(pubkey);
msg.extend_from_slice(&tau2_index.to_le_bytes());
```

---

## Lottery

Block producer selection — deterministic:
```rust
// consensus.rs:527-533
// CORRECT:  seed = SHA3(prev_slice_hash ‖ τ₂_index)
// WRONG:    seed = SHA3(prev_slice_hash ‖ τ₂_index ‖ presence_root)
//                                                    ^^^^^^^^^^^^^^
//                                                    Block producer controls this!
```

---

## FIDO2/WebAuthn

Verified User requires biometric attestation:
```rust
// consensus.rs:382-389
// User Present (UP) flag must be set
if flags & 0x01 == 0 {
    return Err(PresenceError::Fido2UserNotPresent);
}
// User Verified (UV) flag must be set (biometrics)
if flags & 0x04 == 0 {
    return Err(PresenceError::Fido2UserNotVerified);
}
```

---

## Protection

| Attack | Defense |
|--------|---------|
| Sybil | Biometrics + Secure Element |
| Bot | Random interval (10-40 min) |
| Grinding | Seed before block |
| Eclipse | 80/20 tier caps |

---

```
Alejandro Montana
January 2026
```

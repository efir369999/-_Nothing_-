# ACP — Presence-Based Consensus

**Реализация:** `montana/src/consensus.rs`
**Версия:** 1.0

---

## Суть

```rust
// consensus.rs:7-14
// Bitcoin спрашивает: "Сколько работы ты сделал?" (PoW)
// Ethereum спрашивает: "Сколько ты поставил?" (PoS)
// Montana спрашивает: "ТЫ ЗДЕСЬ?"
//
// 80% — серверы (Full Node) — инфраструктура
// 20% — люди (Verified User) — децентрализация
//
// lim(evidence → ∞) 1 Ɉ → 1 секунда
```

---

## Архитектура (80/20)

| Тип узла | Доля | Интервал | Требования |
|----------|------|----------|------------|
| Full Node | 80% | τ₁ (1 мин) | Автоматическая подпись |
| Verified User | 20% | 10-40 мин | Биометрия + FIDO2 |

**Из кода:**
```rust
pub const FULL_NODE_CAP_PERCENT: u64 = 80;
pub const VERIFIED_USER_CAP_PERCENT: u64 = 20;
```

---

## Presence Proof

Full Node подписывает каждую τ₁:
```rust
// consensus.rs:177-190
msg.extend_from_slice(b"MONTANA_PRESENCE_V1:");
msg.extend_from_slice(&timestamp.to_le_bytes());
msg.extend_from_slice(prev_slice_hash);
msg.extend_from_slice(pubkey);
msg.extend_from_slice(&tau2_index.to_le_bytes());
```

---

## Lottery

Выбор producer'а — детерминированный:
```rust
// consensus.rs:527-533
// CORRECT:  seed = SHA3(prev_slice_hash ‖ τ₂_index)
// WRONG:    seed = SHA3(prev_slice_hash ‖ τ₂_index ‖ presence_root)
//                                                    ^^^^^^^^^^^^^^
//                                                    Block producer controls this!
```

---

## FIDO2/WebAuthn

Verified User требует биометрическую аттестацию:
```rust
// consensus.rs:382-389
// User Present (UP) flag must be set
if flags & 0x01 == 0 {
    return Err(PresenceError::Fido2UserNotPresent);
}
// User Verified (UV) flag must be set (biometrics)
if flags & 0x04 == 0 {
    return Err(PresenceError::Fido2UserNotVerified);
}
```

---

## Защита

| Атака | Защита |
|-------|--------|
| Sybil | Биометрия + Secure Element |
| Bot | Случайный интервал (10-40 мин) |
| Grinding | Seed до block |
| Eclipse | 80/20 tier caps |

---

```
Alejandro Montana
Январь 2026
```
